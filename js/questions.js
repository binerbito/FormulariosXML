var formContainer=null;var nota=0;var preguntasSelect=[];var respuestasSelect=[];var valorRespuestaSelect=[];var preguntasText=[];var respuestasText=[];var preguntasCheckBox=[];var respuestasCheckBox=[];var valorRespuestasCheckBox=[];var preguntasRadio=[];var respuestasRadio=[];var valorRespuestaRadio=[];var preguntasSelectMultiple=[];var respuestasSelectMultiple=[];var valorRespuestasSelectMultiple=[];window.onload=function(){formContainer=document.getElementById("myform");formContainer.onsubmit=function(){inicializar();if(comprobar()){document.getElementById("myform").style.display="none";document.getElementById("headMenu").focus();presentarNota();dibujarSeparador("resultadosDiv");corregirSelect();corregirText();corregirCheckBox();corregirRadio();corregirSelectMultiple();actualizarNota()}return false};var a=new XMLHttpRequest();a.onreadystatechange=function(){if(this.readyState==4&&this.status==200){gestionarXml(this)}};a.open("GET","xml/preguntas.xml",true);a.send()};function gestionarXml(a){var c=a.responseXML;var b="";var d=0;for(i=0;i<10;i++){b=c.getElementsByTagName("type")[i].innerHTML;switch(b){case"select":crearDivPregunta(i);imprimirTituloPregunta(i,c);imprimirOpcionesSelect(i,c);preguntasSelect.push(i);respuestasSelect.push(parseInt(c.getElementsByTagName("question")[i].getElementsByTagName("answer")[0].innerHTML));valorRespuestaSelect.push(c.getElementsByTagName("question")[i].getElementsByTagName("option")[respuestasSelect[i]].innerHTML);break;case"text":crearDivPregunta(i);imprimirTituloPregunta(i,c);imprimirCajaText(d,c);d++;preguntasText.push(i);respuestasText.push(parseInt(c.getElementsByTagName("question")[i].getElementsByTagName("answer")[0].innerHTML));break;case"checkbox":crearDivPregunta(i);imprimirTituloPregunta(i,c);imprimirCheckBox(i,c);preguntasCheckBox.push(i);agregarRespuestas(i,c,respuestasCheckBox,valorRespuestasCheckBox);break;case"radio":crearDivPregunta(i);imprimirTituloPregunta(i,c);imprimirRadioButton(i,c);preguntasRadio.push(i);agregarRespuestasRadio(i,c,respuestasRadio,valorRespuestaRadio);break;case"select multiple":crearDivPregunta(i);imprimirTituloPregunta(i,c);imprimirSelectMultiple(i,c);preguntasSelectMultiple.push(i);agregarRespuestas(i,c,respuestasSelectMultiple,valorRespuestasSelectMultiple);break}}imprimirEspacios(3);imprimirBotonCorregir();imprimirEspacios(2)}function imprimirTituloPregunta(b,c){var a=document.createElement("h3");a.innerHTML=c.getElementsByTagName("title")[b].innerHTML;document.getElementById("pregunta"+b).appendChild(a)}function imprimirOpcionesSelect(d,f){var b=f.getElementsByTagName("question")[d].getElementsByTagName("option").length;var c=f.getElementsByTagName("question")[d].getElementsByTagName("option");var a=document.createElement("select");a.id="select"+d;document.getElementById("pregunta"+d).appendChild(a);for(j=0;j<b;j++){var e=document.createElement("option");e.text=c[j].innerHTML;e.value=j;a.options.add(e)}}function imprimirCajaText(c,b){var a=document.createElement("input");a.type="number";a.id="cajaTexto"+c;document.getElementById("pregunta"+i).appendChild(a)}function imprimirCheckBox(e,f){var c=f.getElementsByTagName("question")[e].getElementsByTagName("option").length;var d=f.getElementsByTagName("question")[e].getElementsByTagName("option");for(j=0;j<c;j++){var b=document.createElement("label");var a=document.createElement("input");b.innerHTML=d[j].innerHTML;a.type="checkbox";a.name="preg"+e;a.id="preg"+e+"ans"+j;document.getElementById("pregunta"+e).appendChild(a);document.getElementById("pregunta"+e).appendChild(b);document.getElementById("pregunta"+e).appendChild(document.createElement("br"))}}function imprimirRadioButton(e,g){var b=g.getElementsByTagName("question")[e].getElementsByTagName("option").length;var d=g.getElementsByTagName("question")[e].getElementsByTagName("option");for(j=0;j<b;j++){var a=document.createElement("input");var c=d[j].innerHTML;var f=document.createElement("span");f.innerHTML=c;a.type="radio";a.name="preg"+e;a.id="preg"+e+"ans"+j;document.getElementById("pregunta"+e).appendChild(a);document.getElementById("pregunta"+e).appendChild(f);document.getElementById("pregunta"+e).appendChild(document.createElement("br"))}}function imprimirSelectMultiple(e,g){var b=g.getElementsByTagName("question")[e].getElementsByTagName("option").length;var d=g.getElementsByTagName("question")[e].getElementsByTagName("option");var a=document.createElement("select");a.multiple="true";for(j=0;j<b;j++){var c=d[j].innerHTML;var f=document.createElement("option");f.innerHTML=c;a.appendChild(f)}document.getElementById("pregunta"+e).appendChild(a)}function imprimirEspacios(b){for(i=0;i<b;i++){var a=document.createElement("br");formContainer.appendChild(a)}}function imprimirBotonCorregir(){var a=document.createElement("input");a.id="botonCorregir";a.type="submit";a.value="Corregir";formContainer.appendChild(a)}function corregirSelect(){for(i=0;i<preguntasSelect.length;i++){var a=document.getElementById("pregunta"+preguntasSelect[i]).getElementsByTagName("select")[0];var b=respuestasSelect[i];if(a.selectedIndex==b){puntos=1;darRespuestaCorrectaHtml("P"+preguntasSelect[i]+": Correcto"," +"+puntos+" punto");nota+=puntos}else{darRespuestaIncorrectaHtml("P"+preguntasSelect[i]+": Incorrecto");darRespuestaHtml("La respuesta correcta es: "+valorRespuestaSelect[i])}dibujarSeparador("resultadosDiv")}}function corregirText(){for(i=0;i<preguntasText.length;i++){var a=document.getElementById("pregunta"+preguntasText[i]).getElementsByTagName("input")[0];var b=respuestasText[i];if(a.value==b){puntos=1;darRespuestaCorrectaHtml("P"+preguntasText[i]+": Correcto"," +"+puntos+" punto");nota+=puntos}else{darRespuestaIncorrectaHtml("P"+preguntasText[i]+": Incorrecto");darRespuestaHtml("La respuesta correcta es: "+respuestasText[i])}dibujarSeparador("resultadosDiv")}}function corregirCheckBox(){for(i=0;i<preguntasCheckBox.length;i++){var a=document.getElementById("pregunta"+preguntasCheckBox[i]).getElementsByTagName("input");var b=0;var c=false;for(j=0;j<a.length;j++){var d=false;if(a[j].checked){b=1;for(k=0;k<respuestasCheckBox[i].length;k++){if(j==respuestasCheckBox[i][k]){puntos=1/respuestasCheckBox[i].length;nota+=puntos;darRespuestaCorrectaHtml("P"+preguntasCheckBox[i]+" opcion "+j+": correcta"," +"+puntos.toFixed(2)+" puntos");d=true;break}}if(!d){c=true;puntos=1/respuestasCheckBox[i].length;nota-=puntos;darRespuestaIncorrectaHtml("P"+preguntasCheckBox[i]+" opcion "+j+": incorrecta"," -"+puntos.toFixed(2)+" puntos")}}}if(c){if(valorRespuestasCheckBox[i].length==1){darRespuestaHtml("La respuesta correcta es: "+valorRespuestasCheckBox[i])}else{darRespuestaHtml("Las respuestas correctas son: "+valorRespuestasCheckBox[i].join(", "))}}if(b==0){darRespuestaHtml("P"+preguntasCheckBox[i]+": No has seleccionado ninguna respuesta")}dibujarSeparador("resultadosDiv")}}function corregirRadio(){for(i=0;i<preguntasRadio.length;i++){var b=document.getElementById("pregunta"+preguntasRadio[i]);var a=0;for(j=0;j<b.getElementsByTagName("input").length;j++){if(b.getElementsByTagName("input")[j].checked){a=1;if(j==respuestasRadio[i]){puntos=1;nota+=puntos;darRespuestaCorrectaHtml("P"+preguntasRadio[i]+" opcion "+j+": correcta"," +"+puntos+" punto")}else{puntos=1;nota-=puntos;darRespuestaIncorrectaHtml("P"+preguntasRadio[i]+" opcion "+j+": incorrecta"," -"+puntos+" punto");darRespuestaHtml("La respuesta correcta es: "+valorRespuestaRadio[i])}}}if(a==0){darRespuestaHtml("P"+preguntasRadio[i]+": No has seleccionado ninguna respuesta")}dibujarSeparador("resultadosDiv")}}function corregirSelectMultiple(){for(i=0;i<preguntasSelectMultiple.length;i++){var c=document.getElementById("pregunta"+preguntasSelectMultiple[i]).getElementsByTagName("select")[0];var a=0;var b=false;for(j=0;j<c.length;j++){var d=false;if(c[j].selected){a=1;for(k=0;k<respuestasSelectMultiple[i].length;k++){if(j==respuestasSelectMultiple[i][k]){puntos=1/respuestasSelectMultiple[i].length;nota+=puntos;darRespuestaCorrectaHtml("P"+preguntasSelectMultiple[i]+" opcion "+j+": correcta"," +"+puntos.toFixed(2)+" puntos");d=true;break}}if(!d){b=true;puntos=1/respuestasSelectMultiple[i].length;nota-=puntos;darRespuestaIncorrectaHtml("P"+preguntasSelectMultiple[i]+" opcion "+j+": incorrecta"," -"+puntos.toFixed(2)+" puntos")}}}if(b){if(valorRespuestasSelectMultiple[i].length==1){darRespuestaHtml("La respuesta correcta es: "+valorRespuestasSelectMultiple[i])}else{darRespuestaHtml("Las respuestas correctas son: "+valorRespuestasSelectMultiple[i].join(", "))}}if(a==0){darRespuestaHtml("P"+preguntasSelectMultiple[i]+": No has seleccionado ninguna respuesta")}dibujarSeparador("resultadosDiv")}}function agregarRespuestas(b,e,f,d){var a=[];var c=[];for(j=0;j<e.getElementsByTagName("question")[b].getElementsByTagName("answer").length;j++){a.push(parseInt(e.getElementsByTagName("question")[b].getElementsByTagName("answer")[j].innerHTML))}for(j=0;j<a.length;j++){c.push(e.getElementsByTagName("question")[b].getElementsByTagName("option")[a[j]].innerHTML)}f.push(a);d.push(c)}function agregarRespuestasRadio(a,c,d,b){d.push(parseInt(c.getElementsByTagName("question")[a].getElementsByTagName("answer")[0].innerHTML));b.push(c.getElementsByTagName("question")[a].getElementsByTagName("option")[d[d.length-1]].innerHTML)}function crearDivPregunta(a){var b=document.createElement("div");b.id="pregunta"+a;formContainer.appendChild(b)}function inicializar(){document.getElementById("resultadosDiv").innerHTML="";nota=0}function agregarIconoCorreccion(a){if(a=="v"){var b=document.createElement("img");b.src="img/correcto.png";document.getElementById("resultadosDiv").appendChild(b)}else{var b=document.createElement("img");b.src="img/incorrecto.png";document.getElementById("resultadosDiv").appendChild(b)}}function darRespuestaHtml(c){var d=document.createElement("span");var b=document.createTextNode(c);d.appendChild(b);var a=document.createElement("br");document.getElementById("resultadosDiv").appendChild(d);document.getElementById("resultadosDiv").appendChild(a)}function darRespuestaCorrectaHtml(g,f){var h=document.createElement("span");var e=document.createTextNode(g);h.appendChild(e);var b=document.createElement("span");var a=document.createTextNode(f);b.appendChild(a);b.className="correcto";var d=document.createElement("img");d.src="img/correcto.png";var c=document.createElement("br");document.getElementById("resultadosDiv").appendChild(h);document.getElementById("resultadosDiv").appendChild(d);document.getElementById("resultadosDiv").appendChild(b);document.getElementById("resultadosDiv").appendChild(c)}function darRespuestaIncorrectaHtml(g,f){var h=document.createElement("span");var e=document.createTextNode(g);h.appendChild(e);var b=document.createElement("span");var a=document.createTextNode(f);b.appendChild(a);b.className="incorrecto";var d=document.createElement("img");d.src="img/incorrecto.png";var c=document.createElement("br");document.getElementById("resultadosDiv").appendChild(h);document.getElementById("resultadosDiv").appendChild(d);if(f!=null){document.getElementById("resultadosDiv").appendChild(b)}document.getElementById("resultadosDiv").appendChild(c)}function presentarNota(){var c=document.createElement("span");var b=document.createTextNode("");c.appendChild(b);c.id="nota";var a=document.createElement("br");document.getElementById("resultadosDiv").appendChild(c);document.getElementById("resultadosDiv").appendChild(a)}function actualizarNota(){document.getElementById("nota").textContent="Nota: "+nota.toFixed(2)+" puntos sobre 10";if(nota>=5){document.getElementById("nota").style.color="#27b63a"}}function dibujarSeparador(a){var b=document.createElement("p");b.className="separador";document.getElementById(a).appendChild(b)}window.onmousedown=function(c){var b=c.target;if(b.tagName.toLowerCase()=="option"&&b.parentNode.hasAttribute("multiple")){c.preventDefault();if(b.hasAttribute("selected")){b.removeAttribute("selected")}else{b.setAttribute("selected","")}var a=b.parentNode.cloneNode(true);b.parentNode.parentNode.replaceChild(a,b.parentNode)}};function comprobar(){for(i=0;i<preguntasText.length;i++){var a=document.getElementById("pregunta"+preguntasText[i]).getElementsByTagName("input")[0];if(a.value==""){a.focus();alert("Escribe un numero en la pregunta "+preguntasText[i]);return false}}return true};